# 阻抗控制 (Impedance Control)

## 算法原理 (Algorithm Principles)

### 机械臂动力学模型 (Robot Arm Dynamics Model)

首先，考虑机械臂的动力学方程。在不考虑外部干扰力的情况下，机械臂的动力学模型可表示为：

$$
\tau' = \underbrace{M(q)\ddot{q} + C(q,\dot{q}) + G(q)}_{机械臂动力学项}
$$

其中：

- $\tau'$ 表示关节驱动力矩
- $M(q)$ 表示机械臂的惯性矩阵
- $C(q,\dot{q})$ 表示科里奥利力和离心力
- $G(q)$ 表示重力项
- $q$, $\dot{q}$, $\ddot{q}$ 分别表示关节位置、速度和加速度

### 末端力与关节力矩的关系 (End-effector Force and Joint Torque Relationship)

如果将机械臂的末端抽象为一个质点，由于电机和机械臂自身的物理属性，该质点会在笛卡尔坐标系下产生一个力 $F$。该力与电机力矩 $\tau$ 的关系如下：

$$
\tau - \tau' = \underbrace{J^T(q)}_{雅可比矩阵转置}F
$$

其中 $J^T(q)$ 是雅可比矩阵的转置，它将末端力映射到关节力矩空间。

### 阻抗控制模型 (Impedance Control Model)

阻抗控制的核心思想是控制机械臂末端按照弹簧-阻尼系统的动力学特性进行运动。本文考虑最简单的弹簧系统模型：当末端位置偏离期望位置时，系统产生一个纠正力，偏差越大，纠正力越大。

设弹簧系统的平衡位置（期望位置）为 $P_d$，即当末端处于该位置时，系统不产生纠正力。此时，弹簧系统的动力学方程为：

$$
F = \lambda(P_d - \underbrace{T(q)}_{正运动学})
$$

其中：

- $\lambda$ 表示弹簧系统的刚度系数
- $T(q)$ 表示机械臂的正运动学，用于计算末端当前位置
- $(P_d - T(q))$ 表示末端位置的偏差

可以看出，$\lambda$ 值越大，系统能产生的纠正力也就越大，响应也越迅速。

### 阻抗控制器设计 (Impedance Controller Design)

对于机械臂而言，实际执行控制的是电机，因此整体的控制器设计如下：

$$
\tau = \lambda J^T(q)(\underbrace{P_d - T(q)}_{位置偏差}) + \underbrace{M(q)\ddot{q} + C(q,\dot{q}) + G(q)}_{动力学前馈项}
$$

该控制器由两部分组成：

1. $\lambda J^T(q)(P_d - T(q))$：基于位置偏差的纠正力矩
2. $M(q)\ddot{q} + C(q,\dot{q}) + G(q)$：动力学前馈补偿项

## 实现要点 (Implementation Essentials)

要实现机械臂的阻抗控制，需要计算以下关键项：

- **动力学模型**：$\underbrace{M(q)\ddot{q} + C(q,\dot{q}) + G(q)}_{需要参数辨识}$（实际机器人需要进行参数辨识）
- **正运动学**：$\underbrace{T(q)}_{末端位姿计算}$ 用于计算机械臂末端的位姿（笛卡尔坐标系，通常表示为 `xyzrpy`）
- **雅可比矩阵**：$\underbrace{J(q)}_{速度映射矩阵}$ 用于力的坐标变换

## 控制参数 (Control Parameters)

阻抗控制的主要输入参数包括：

- **刚度系数** $\underbrace{\lambda}_{弹簧刚度}$：表示弹簧系统的刚度，决定了系统对位置偏差的响应强度
- **期望位置** $\underbrace{P_d}_{目标位置}$：表示弹簧系统的平衡位置，即控制目标位置

通过调整这些参数，可以实现不同的交互行为，从柔顺的人机交互到精确的位置控制。
